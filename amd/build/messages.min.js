define(["jquery"],function(a){var b=[],c=560,d=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null===d?"":d[1]};return{init:function(e){var f=d("id");if(f&&e!==f)a(".message-drawer").hide(),a("#page-message-edit").css("overflow","auto");else{document.addEventListener("messages-drawer:toggle",function(){(a("#page-message-edit").length||a("#page-message-index").length)&&(a(".block_settings").hasClass("state-visible")||a(".block_settings").hasClass("state-visible")?a(window).width()<c?a(".message-drawer").hide():a(".message-drawer").animate({width:"50%"},0):a(window).width()<c?a(".message-drawer").show():a(".message-drawer").animate({width:"100%"},0))}),document.addEventListener("messages-drawer:pm-toggle",function(){(a("#page-message-edit").length||a("#page-message-index").length)&&(a(".snap-pm-open").length?a(".message-drawer").hide():a(".message-drawer").show())});var g=a("div.popover-region");g.on("popoverregion:menuopened",function(){if(a("#page-message-edit").length||a("#page-message-index").length){var d=a(this).attr("id");b.indexOf(d)==-1&&b.push(d),b.length>0&&(a(window).width()<c?a(".message-drawer").hide():a(".message-drawer").animate({width:"50%"},0))}}).bind(),g.on("popoverregion:menuclosed",function(){if(a("#page-message-edit").length||a("#page-message-index").length){var d=a(this).attr("id"),e=b.indexOf(d);b.splice(e,1),0==b.length&&(a(window).width()<c?a(".message-drawer").show():a(".message-drawer").animate({width:"100%"},0))}}).bind()}}}});